<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Seven Sins of Python - Sin 5 | Klebstoff</title>
<meta name=keywords content="seven-sins-of-python">
<meta name=description content="Sin number 5: global destruction Every time I am asked about global keyword in Python, I get a split-second heart attack. Personally I think it is one of the most unnecessary and dangerous keywords that Python has to offer. I will go one step further and postulate that if you&rsquo;re using nonlocal you&rsquo;re probably doing it wrong.
 ðŸ‘‰ The essence of this problem is misunderstanding the purpose or the mechanics of scope in Python.">
<meta name=author content>
<link rel=canonical href=http://kjczarne.github.io/2021-12-28-seven-sins-of-python-sin-5/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=http://kjczarne.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=http://kjczarne.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=http://kjczarne.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=http://kjczarne.github.io/apple-touch-icon.png>
<link rel=mask-icon href=http://kjczarne.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.0">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="Seven Sins of Python - Sin 5">
<meta property="og:description" content="Sin number 5: global destruction Every time I am asked about global keyword in Python, I get a split-second heart attack. Personally I think it is one of the most unnecessary and dangerous keywords that Python has to offer. I will go one step further and postulate that if you&rsquo;re using nonlocal you&rsquo;re probably doing it wrong.
 ðŸ‘‰ The essence of this problem is misunderstanding the purpose or the mechanics of scope in Python.">
<meta property="og:type" content="article">
<meta property="og:url" content="http://kjczarne.github.io/2021-12-28-seven-sins-of-python-sin-5/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-12-28T23:43:52+01:00">
<meta property="article:modified_time" content="2021-12-28T23:43:52+01:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Seven Sins of Python - Sin 5">
<meta name=twitter:description content="Sin number 5: global destruction Every time I am asked about global keyword in Python, I get a split-second heart attack. Personally I think it is one of the most unnecessary and dangerous keywords that Python has to offer. I will go one step further and postulate that if you&rsquo;re using nonlocal you&rsquo;re probably doing it wrong.
 ðŸ‘‰ The essence of this problem is misunderstanding the purpose or the mechanics of scope in Python.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://kjczarne.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Seven Sins of Python - Sin 5","item":"http://kjczarne.github.io/2021-12-28-seven-sins-of-python-sin-5/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Seven Sins of Python - Sin 5","name":"Seven Sins of Python - Sin 5","description":"Sin number 5: global destruction Every time I am asked about global keyword in Python, I get a split-second heart attack. Personally I think it is one of the most unnecessary and dangerous keywords that Python has to offer. I will go one step further and postulate that if you\u0026rsquo;re using nonlocal you\u0026rsquo;re probably doing it wrong.\n ðŸ‘‰ The essence of this problem is misunderstanding the purpose or the mechanics of scope in Python.","keywords":["seven-sins-of-python"],"articleBody":"Sin number 5: global destruction Every time I am asked about global keyword in Python, I get a split-second heart attack. Personally I think it is one of the most unnecessary and dangerous keywords that Python has to offer. I will go one step further and postulate that if youâ€™re using nonlocal youâ€™re probably doing it wrong.\n ðŸ‘‰ The essence of this problem is misunderstanding the purpose or the mechanics of scope in Python.\n Whence the temptation? Consider a very simple example. Imagine youâ€™ve just learned about the existence of functions in Python and you want to reuse repetitive pieces of code as much as possible:\ndef concatenate_all_strings(): string1 = \"a\" string2 = \"b\" string3 = \"c\" return string1 + string2 + string3 print(concatenate_all_strings()) Great! This works. But what if you want to use string1 somewhere else? Letâ€™s say I type up 100 more lines of code and Iâ€™m suddenly in need of printing out the string1 variable:\ndef concatenate_all_strings(): string1 = \"a\" string2 = \"b\" string3 = \"c\" return string1 + string2 + string3 print(concatenate_all_strings()) # 100 more lines of some code... print(string1) What you get when you run this script would be: NameError: name 'string1' is not defined. Now you start searching the Internet for a solution to your problem and inadvertently you find that the simplest way to make a variable that exists within a function body accessible elsewhere is to use global. You will then merrily refactor the above to:\ndef concatenate_all_strings(): global string1 global string2 global string3 string1 = \"a\" string2 = \"b\" string3 = \"c\" return string1 + string2 + string3 print(concatenate_all_strings()) # 100 more lines of some code... print(string1) Why is this a sin? This creates a potential for name conflicts and introduces a lack of clarity. When you refuse to use scoped variables and declare everything as global when you want to share variables, you will inadvertetly run into situations where a local variable has the same name as one in an outer scope and depending on which one is evaluated when, you will either end up with the value declared in the outer scope or the inner scope. Furthermore, any implicit modification of the global state makes code harder to understand because you end up searching for the variables in each function body.\nThis is especially painful when you realize how easy it is to avoid using global altogether and that avoiding global comes naturally when you know some proper functional patterns.\nHow to recognize a sinner? Any use of global or nonlocal should put up red flags. Honestly, I havenâ€™t seen any piece of code in my life that couldnâ€™t be refactored to avoid these keywords and such refactoring always resulted in improvements in code maintainability.\n ðŸ‘€ Remember, just because some solution is more concise and quicker to implement, doesnâ€™t mean that it will lead to better maintainability. Always assume that somebody else will read your code, thus you should use patterns that make it easy to pinpoint the flow of information in a clear way. global is not one of those patterns. Also, consider that even if nobody else will end up reading your code in the future, your future self might not remember what the project was about in a few weeks. So if not for the sake of your colleagues, avoid antipatterns as a good deed for your future self.\n How to repent? Understand and leverage scope Most uses of global stem from the misunderstanding of scope. Scope essentially means that whatever is within a function or a class belongs to that function or class if itâ€™s declared there. Anything from the outer scope is accessible to the inner scope but the inverse is not true. You should put variable declarations into such a scope that can be accessed by all the consumers of those variables. In our example this would be the top-level scope of the Python module that we were running:\nstring1 = \"a\" # accessible to both `concatenate_all_strings` and top-level `print` def concatenate_all_strings(): string2 = \"b\" # accessible only within this function string3 = \"c\" # accessible only within this function return string1 + string2 + string3 print(concatenate_all_strings()) # 100 more lines of some code... print(string1) The good part is that if I needed to declare a variable named string2 in the top-level of the script and print it but I would like to keep the original string2 value within the function I could simply do this:\nstring1 = \"a\" string2 = \"lol\" def concatenate_all_strings(): string2 = \"b\" # accessible only within this function string3 = \"c\" # accessible only within this function return string1 + string2 + string3 print(concatenate_all_strings()) # prints \"abc\" # 100 more lines of some code... print(string1) # prints \"a\" print(string2) # prints \"lol\" With scoping itâ€™s clear where a particular variable belongs. Every time you enter function scope or class scope itâ€™s a bit like entering a different room in a house. The mirror that hangs on the wall of your own bedroom looks different to the one in your bathroom. The name is still the same but the value doesnâ€™t have to be and it still makes sense that two rooms have a mirror object within them.\nTreat functions like physical factory machines If youâ€™ve worked with Python for a while you will realize that the solution above is kind of lousy and lazy as well. And if you paid attention in math classes you will realize that our function concatenate_all_strings does not really behave like a mathematical function.\n ðŸ‘€ In mathematics, a function is an instrument that takes a set of arguments and produces one value from that set of arguments. In programming, we call functions equivalent to mathematical functions pure functions.\n Whenever you have the chance you should parameterize what you can and use pure functions. In Python, if you combine that with type hints, the function signature, i.e. the function name alongside its parameters and return type, gives you a very clear idea of what the function does and how it should behave.\nstring1 = \"a\" string2 = \"b\" string3 = \"c\" def concatenate_all_strings(string1: str, string2: str, string3: str) - str: return string1 + string2 + string3 print(concatenate_all_strings(string1=string1, string2=string2, string3=string3)) # 100 more lines of some code... print(string1) Notice how def concatenate_all_strings(string1: str, string2: str, string3: str) - str tells you almost everything you need to know about the function. It takes in 3 strings and returns a single string and if the name is to be trusted it will probably concatenate the input strings. This function is pure. It does not modify the input in any way, it simply takes the input and produces some output, like a factory machine that takes in some raw material and returns a product. Actually, itâ€™s even better because it does not destroy string1, string2 and string3 in the process so these can be later reused.\nIdentify repetition and parameterize Finally, the way I would refactor the example:\nfrom typing import List string1 = \"a\" string2 = \"b\" string3 = \"c\" def concatenate_all_strings(string_list: List[str]) - str: result = \"\" for s in string_list: result += s return result print(concatenate_all_strings([string1, string2, string3])) # 100 more lines of some code... print(string1) When parameterizing functions that used to abuse global or nonlocal you will realize that there may be some sensless repetition involved and the number of parameters quickly explodes. What if I wanted to concatenate not 3 but 4, 5, 6, etc. strings? Every time I would like to add another one, Iâ€™d need to add it to the parameter list and then call the function with an additional argument. This is tedious. When you realize this is the way itâ€™s going, think about generalizing the parameter set a bit more. In this case a list of arbitrary length might be the best choice. In other cases you might want to use generators, dictionaries, etc.\n ðŸ¤” You might be wondering why I didnâ€™t use the *args idiom and used a list as a parameter. Type annotations on *args and **kwargs can sometimes get tricky and this makes the function signature almost always less explicit. Some programming languages do not even support variable number of arguments in functions, Rust for example allows you to do that only in macros, which are essentially generating Rust code before compilation happens and are not functions that will be evaluated at runtime. My advice is to avoid *args and **kwargs unless there is a very good reason for the user interface to leverage them.\n Learn advanced scope patterns Last, letâ€™s take a look at something more advanced if youâ€™re coming here for some more serious patterns.\nScoping can be really powerful. My favorite example is a closure. In Rust closures are basically lambda functions that can capture their outer scope:\nfn do_something() { let x: i32 = 5; let add_x = |i| i + x; // `x` is grabbed from the outer scope  add_x // `add_x` is returned } let lazy_add_x = do_something(); let result = lazy_add_x(5); println!(\"{}\", result); In Python, all functions can capture their outer scope. Thus the idea of a closure should usually be expressed with a nested function:\nfrom typing import Callable def add_x(i: int) - Callable[[], int]: x = 5 def wrapper(): # `x` is grabbed from outer scope return i + x return wrapper lazy_add_x = add_x(5) result = lazy_add_x() print(result) print(x) # fails, `x` only exists within `add_x` scope Conclusions  ðŸ‘‰ Never use global and nonlocal. If you find you need it, itâ€™s probably because you have a design flaw in your code or youâ€™re misunderstanding scope.\n  ðŸ‘‰ When using functions parameterize what you can for better code reuse.\n  ðŸ‘‰ Use pure functions whenever you can. Donâ€™t silently modify state, return values instead.\n  ðŸ‘‰ If you find yourself copy-pasting or repeating more or less the same thing over and over again, thereâ€™s probably a more general parameter set that you could leverage.\n ","wordCount":"1654","inLanguage":"en","datePublished":"2021-12-28T23:43:52+01:00","dateModified":"2021-12-28T23:43:52+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://kjczarne.github.io/2021-12-28-seven-sins-of-python-sin-5/"},"publisher":{"@type":"Organization","name":"Klebstoff","logo":{"@type":"ImageObject","url":"http://kjczarne.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=http://kjczarne.github.io/ accesskey=h title="Klebstoff (Alt + H)">Klebstoff</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=http://kjczarne.github.io/posts/ title=posts>
<span>posts</span>
</a>
</li>
<li>
<a href=http://kjczarne.github.io/search/ title="search (Alt + /)" accesskey=/>
<span>search</span>
</a>
</li>
<li>
<a href=http://kjczarne.github.io/tags/ title=tags>
<span>tags</span>
</a>
</li>
<li>
<a href=http://kjczarne.github.io/categories/ title=categories>
<span>categories</span>
</a>
</li>
<li>
<a href=http://kjczarne.github.io/about/ title=about>
<span>about</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Seven Sins of Python - Sin 5
</h1>
<div class=post-meta><span title="2021-12-28 23:43:52 +0100 +0100">December 28, 2021</span>&nbsp;Â·&nbsp;8 min
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#sin-number-5-global-destruction aria-label="Sin number 5: global destruction">Sin number 5: <code>global</code> destruction</a><ul>
<li>
<a href=#whence-the-temptation aria-label="Whence the temptation?">Whence the temptation?</a></li>
<li>
<a href=#why-is-this-a-sin aria-label="Why is this a sin?">Why is this a sin?</a></li>
<li>
<a href=#how-to-recognize-a-sinner aria-label="How to recognize a sinner?">How to recognize a sinner?</a></li>
<li>
<a href=#how-to-repent aria-label="How to repent?">How to repent?</a><ul>
<li>
<a href=#understand-and-leverage-scope aria-label="Understand and leverage scope">Understand and leverage scope</a></li>
<li>
<a href=#treat-functions-like-physical-factory-machines aria-label="Treat functions like physical factory machines">Treat functions like physical factory machines</a></li>
<li>
<a href=#identify-repetition-and-parameterize aria-label="Identify repetition and parameterize">Identify repetition and parameterize</a></li>
<li>
<a href=#learn-advanced-scope-patterns aria-label="Learn advanced scope patterns">Learn advanced scope patterns</a></li>
<li>
<a href=#conclusions aria-label=Conclusions>Conclusions</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h2 id=sin-number-5-global-destruction>Sin number 5: <code>global</code> destruction<a hidden class=anchor aria-hidden=true href=#sin-number-5-global-destruction>#</a></h2>
<p>Every time I am asked about <code>global</code> keyword in Python, I get a split-second heart attack. Personally I think it is one of the most unnecessary and dangerous keywords that Python has to offer. I will go one step further and postulate that if you&rsquo;re using <code>nonlocal</code> you&rsquo;re probably doing it wrong.</p>
<blockquote>
<p>ðŸ‘‰ The essence of this problem is misunderstanding the purpose or the mechanics of <strong>scope</strong> in Python.</p>
</blockquote>
<h3 id=whence-the-temptation>Whence the temptation?<a hidden class=anchor aria-hidden=true href=#whence-the-temptation>#</a></h3>
<p>Consider a very simple example. Imagine you&rsquo;ve just learned about the existence of functions in Python and you want to reuse repetitive pieces of code as much as possible:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>concatenate_all_strings</span>():
    string1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;a&#34;</span>
    string2 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;b&#34;</span>
    string3 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;c&#34;</span>
    <span style=color:#66d9ef>return</span> string1 <span style=color:#f92672>+</span> string2 <span style=color:#f92672>+</span> string3


print(concatenate_all_strings())
</code></pre></div><p>Great! This works. But what if you want to use <code>string1</code> somewhere else? Let&rsquo;s say I type up 100 more lines of code and I&rsquo;m suddenly in need of printing out the <code>string1</code> variable:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>concatenate_all_strings</span>():
    string1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;a&#34;</span>
    string2 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;b&#34;</span>
    string3 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;c&#34;</span>
    <span style=color:#66d9ef>return</span> string1 <span style=color:#f92672>+</span> string2 <span style=color:#f92672>+</span> string3


print(concatenate_all_strings())

<span style=color:#75715e># 100 more lines of some code...</span>

print(string1)
</code></pre></div><p>What you get when you run this script would be: <code>NameError: name 'string1' is not defined</code>. Now you start searching the Internet for a solution to your problem and inadvertently you find that the simplest way to make a variable that exists within a function body accessible elsewhere is to use <code>global</code>. You will then merrily refactor the above to:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>concatenate_all_strings</span>():
    <span style=color:#66d9ef>global</span> string1
    <span style=color:#66d9ef>global</span> string2
    <span style=color:#66d9ef>global</span> string3
    string1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;a&#34;</span>
    string2 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;b&#34;</span>
    string3 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;c&#34;</span>
    <span style=color:#66d9ef>return</span> string1 <span style=color:#f92672>+</span> string2 <span style=color:#f92672>+</span> string3


print(concatenate_all_strings())

<span style=color:#75715e># 100 more lines of some code...</span>

print(string1)
</code></pre></div><h3 id=why-is-this-a-sin>Why is this a sin?<a hidden class=anchor aria-hidden=true href=#why-is-this-a-sin>#</a></h3>
<p>This creates a potential for name conflicts and introduces a lack of clarity. When you refuse to use scoped variables and declare everything as <code>global</code> when you want to share variables, you will inadvertetly run into situations where a local variable has the same name as one in an outer scope and depending on which one is evaluated when, you will either end up with the value declared in the outer scope or the inner scope. Furthermore, any implicit modification of the global state makes code harder to understand because you end up searching for the variables in each function body.</p>
<p>This is especially painful when you realize how easy it is to avoid using <code>global</code> altogether and that avoiding <code>global</code> comes naturally when you know some proper functional patterns.</p>
<h3 id=how-to-recognize-a-sinner>How to recognize a sinner?<a hidden class=anchor aria-hidden=true href=#how-to-recognize-a-sinner>#</a></h3>
<p>Any use of <code>global</code> or <code>nonlocal</code> should put up red flags. Honestly, I haven&rsquo;t seen any piece of code in my life that couldn&rsquo;t be refactored to avoid these keywords and such refactoring always resulted in improvements in code maintainability.</p>
<blockquote>
<p>ðŸ‘€ Remember, just because some solution is more concise and quicker to implement, doesn&rsquo;t mean that it will lead to better maintainability. Always assume that somebody else will read your code, thus you should use patterns that make it easy to pinpoint the flow of information in a clear way. <code>global</code> is not one of those patterns. Also, consider that even if nobody else will end up reading your code in the future, your future self might not remember what the project was about in a few weeks. So if not for the sake of your colleagues, avoid antipatterns as a good deed for your future self.</p>
</blockquote>
<h3 id=how-to-repent>How to repent?<a hidden class=anchor aria-hidden=true href=#how-to-repent>#</a></h3>
<h4 id=understand-and-leverage-scope>Understand and leverage scope<a hidden class=anchor aria-hidden=true href=#understand-and-leverage-scope>#</a></h4>
<p>Most uses of <code>global</code> stem from the misunderstanding of scope. Scope essentially means that whatever is <em>within</em> a function or a class belongs to that function or class if it&rsquo;s declared there. Anything from the outer scope is accessible to the inner scope but the inverse is not true. You should put variable declarations into such a scope that can be accessed by all the consumers of those variables. In our example this would be the top-level scope of the Python module that we were running:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>string1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;a&#34;</span>  <span style=color:#75715e># accessible to both `concatenate_all_strings` and top-level `print`</span>

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>concatenate_all_strings</span>():
    string2 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;b&#34;</span>  <span style=color:#75715e># accessible only within this function</span>
    string3 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;c&#34;</span>  <span style=color:#75715e># accessible only within this function</span>
    <span style=color:#66d9ef>return</span> string1 <span style=color:#f92672>+</span> string2 <span style=color:#f92672>+</span> string3


print(concatenate_all_strings())

<span style=color:#75715e># 100 more lines of some code...</span>

print(string1)
</code></pre></div><p>The good part is that if I needed to declare a variable named <code>string2</code> in the top-level of the script and print it but I would like to keep the original <code>string2</code> value within the function I could simply do this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>string1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;a&#34;</span>
string2 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;lol&#34;</span>

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>concatenate_all_strings</span>():
    string2 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;b&#34;</span>  <span style=color:#75715e># accessible only within this function</span>
    string3 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;c&#34;</span>  <span style=color:#75715e># accessible only within this function</span>
    <span style=color:#66d9ef>return</span> string1 <span style=color:#f92672>+</span> string2 <span style=color:#f92672>+</span> string3


print(concatenate_all_strings())  <span style=color:#75715e># prints &#34;abc&#34;</span>

<span style=color:#75715e># 100 more lines of some code...</span>

print(string1)  <span style=color:#75715e># prints &#34;a&#34;</span>
print(string2)  <span style=color:#75715e># prints &#34;lol&#34;</span>
</code></pre></div><p>With scoping it&rsquo;s clear where a particular variable belongs. Every time you enter function scope or class scope it&rsquo;s a bit like entering a different room in a house. The mirror that hangs on the wall of your own bedroom looks different to the one in your bathroom. The name is still the same but the value doesn&rsquo;t have to be and it still makes sense that two rooms have a <code>mirror</code> object within them.</p>
<h4 id=treat-functions-like-physical-factory-machines>Treat functions like physical factory machines<a hidden class=anchor aria-hidden=true href=#treat-functions-like-physical-factory-machines>#</a></h4>
<p>If you&rsquo;ve worked with Python for a while you will realize that the solution above is kind of lousy and lazy as well. And if you paid attention in math classes you will realize that our function <code>concatenate_all_strings</code> does not really behave like a mathematical function.</p>
<blockquote>
<p>ðŸ‘€ In mathematics, a function is an instrument that takes a set of arguments and produces one value from that set of arguments. In programming, we call functions equivalent to mathematical functions <em>pure functions</em>.</p>
</blockquote>
<p>Whenever you have the chance you should <strong>parameterize what you can and use pure functions</strong>. In Python, if you combine that with type hints, the function signature, i.e. the function name alongside its parameters and return type, gives you a very clear idea of what the function does and how it should behave.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>string1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;a&#34;</span>
string2 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;b&#34;</span>
string3 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;c&#34;</span>

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>concatenate_all_strings</span>(string1: str, string2: str, string3: str) <span style=color:#f92672>-&gt;</span> str:
    <span style=color:#66d9ef>return</span> string1 <span style=color:#f92672>+</span> string2 <span style=color:#f92672>+</span> string3


print(concatenate_all_strings(string1<span style=color:#f92672>=</span>string1, string2<span style=color:#f92672>=</span>string2, string3<span style=color:#f92672>=</span>string3))

<span style=color:#75715e># 100 more lines of some code...</span>

print(string1)
</code></pre></div><p>Notice how <code>def concatenate_all_strings(string1: str, string2: str, string3: str) -> str</code> tells you almost everything you need to know about the function. It takes in 3 strings and returns a single string and if the name is to be trusted it will probably concatenate the input strings. This function is <strong>pure</strong>. It does not modify the input in any way, it simply takes the input and produces some output, like a factory machine that takes in some raw material and returns a product. Actually, it&rsquo;s even better because it does not destroy <code>string1</code>, <code>string2</code> and <code>string3</code> in the process so these can be later reused.</p>
<h4 id=identify-repetition-and-parameterize>Identify repetition and parameterize<a hidden class=anchor aria-hidden=true href=#identify-repetition-and-parameterize>#</a></h4>
<p>Finally, the way I would refactor the example:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> List

string1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;a&#34;</span>
string2 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;b&#34;</span>
string3 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;c&#34;</span>

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>concatenate_all_strings</span>(string_list: List[str]) <span style=color:#f92672>-&gt;</span> str:
    result <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
    <span style=color:#66d9ef>for</span> s <span style=color:#f92672>in</span> string_list:
        result <span style=color:#f92672>+=</span> s
    <span style=color:#66d9ef>return</span> result


print(concatenate_all_strings([string1, string2, string3]))

<span style=color:#75715e># 100 more lines of some code...</span>

print(string1)
</code></pre></div><p>When parameterizing functions that used to abuse <code>global</code> or <code>nonlocal</code> you will realize that there may be some sensless repetition involved and the number of parameters quickly explodes. What if I wanted to concatenate not 3 but 4, 5, 6, etc. strings? Every time I would like to add another one, I&rsquo;d need to add it to the parameter list and then call the function with an additional argument. This is tedious. When you realize this is the way it&rsquo;s going, think about generalizing the parameter set a bit more. In this case a list of arbitrary length might be the best choice. In other cases you might want to use generators, dictionaries, etc.</p>
<blockquote>
<p>ðŸ¤” You might be wondering why I didn&rsquo;t use the <code>*args</code> idiom and used a list as a parameter. Type annotations on <code>*args</code> and <code>**kwargs</code> can sometimes get tricky and this makes the function signature almost always less explicit. Some programming languages do not even support variable number of arguments in functions, Rust for example allows you to do that only in macros, which are essentially generating Rust code before compilation happens and are not functions that will be evaluated at runtime. My advice is to avoid <code>*args</code> and <code>**kwargs</code> unless there is a very good reason for the user interface to leverage them.</p>
</blockquote>
<h4 id=learn-advanced-scope-patterns>Learn advanced scope patterns<a hidden class=anchor aria-hidden=true href=#learn-advanced-scope-patterns>#</a></h4>
<p>Last, let&rsquo;s take a look at something more advanced if you&rsquo;re coming here for some more serious patterns.</p>
<p>Scoping can be really powerful. My favorite example is a closure. In Rust closures are basically lambda functions that can capture their outer scope:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>do_something</span>() {
  <span style=color:#66d9ef>let</span> x: <span style=color:#66d9ef>i32</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;

  <span style=color:#66d9ef>let</span> add_x <span style=color:#f92672>=</span> <span style=color:#f92672>|</span>i<span style=color:#f92672>|</span> i <span style=color:#f92672>+</span> x;  <span style=color:#75715e>// `x` is grabbed from the outer scope
</span><span style=color:#75715e></span>  add_x  <span style=color:#75715e>// `add_x` is returned
</span><span style=color:#75715e></span>}

<span style=color:#66d9ef>let</span> lazy_add_x <span style=color:#f92672>=</span> do_something();
<span style=color:#66d9ef>let</span> result <span style=color:#f92672>=</span> lazy_add_x(<span style=color:#ae81ff>5</span>);
println!(<span style=color:#e6db74>&#34;{}&#34;</span>, result);
</code></pre></div><p>In Python, <em>all</em> functions can capture their outer scope. Thus the idea of a closure should usually be expressed with a nested function:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> Callable


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>add_x</span>(i: int) <span style=color:#f92672>-&gt;</span> Callable[[], int]:
    x <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>wrapper</span>():
        <span style=color:#75715e># `x` is grabbed from outer scope</span>
        <span style=color:#66d9ef>return</span> i <span style=color:#f92672>+</span> x

    <span style=color:#66d9ef>return</span> wrapper


lazy_add_x <span style=color:#f92672>=</span> add_x(<span style=color:#ae81ff>5</span>)
result <span style=color:#f92672>=</span> lazy_add_x()
print(result)
print(x)  <span style=color:#75715e># fails, `x` only exists within `add_x` scope</span>
</code></pre></div><h4 id=conclusions>Conclusions<a hidden class=anchor aria-hidden=true href=#conclusions>#</a></h4>
<blockquote>
<p>ðŸ‘‰ Never use <code>global</code> and <code>nonlocal</code>. If you find you need it, it&rsquo;s probably because you have a design flaw in your code or you&rsquo;re misunderstanding scope.</p>
</blockquote>
<blockquote>
<p>ðŸ‘‰ When using functions parameterize what you can for better code reuse.</p>
</blockquote>
<blockquote>
<p>ðŸ‘‰ Use pure functions whenever you can. Don&rsquo;t silently modify state, return values instead.</p>
</blockquote>
<blockquote>
<p>ðŸ‘‰ If you find yourself copy-pasting or repeating more or less the same thing over and over again, there&rsquo;s probably a more general parameter set that you could leverage.</p>
</blockquote>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=http://kjczarne.github.io/tags/seven-sins-of-python/>seven-sins-of-python</a></li>
</ul>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Seven Sins of Python - Sin 5 on twitter" href="https://twitter.com/intent/tweet/?text=Seven%20Sins%20of%20Python%20-%20Sin%205&url=http%3a%2f%2fkjczarne.github.io%2f2021-12-28-seven-sins-of-python-sin-5%2f&hashtags=seven-sins-of-python"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Seven Sins of Python - Sin 5 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fkjczarne.github.io%2f2021-12-28-seven-sins-of-python-sin-5%2f&title=Seven%20Sins%20of%20Python%20-%20Sin%205&summary=Seven%20Sins%20of%20Python%20-%20Sin%205&source=http%3a%2f%2fkjczarne.github.io%2f2021-12-28-seven-sins-of-python-sin-5%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Seven Sins of Python - Sin 5 on reddit" href="https://reddit.com/submit?url=http%3a%2f%2fkjczarne.github.io%2f2021-12-28-seven-sins-of-python-sin-5%2f&title=Seven%20Sins%20of%20Python%20-%20Sin%205"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Seven Sins of Python - Sin 5 on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2fkjczarne.github.io%2f2021-12-28-seven-sins-of-python-sin-5%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Seven Sins of Python - Sin 5 on whatsapp" href="https://api.whatsapp.com/send?text=Seven%20Sins%20of%20Python%20-%20Sin%205%20-%20http%3a%2f%2fkjczarne.github.io%2f2021-12-28-seven-sins-of-python-sin-5%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Seven Sins of Python - Sin 5 on telegram" href="https://telegram.me/share/url?text=Seven%20Sins%20of%20Python%20-%20Sin%205&url=http%3a%2f%2fkjczarne.github.io%2f2021-12-28-seven-sins-of-python-sin-5%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer><div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//kjczarne.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
<script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!0,securityLevel:'loose'})</script>
<script>window.onload=function(){mermaid.init(void 0,".language-mermaid")}</script>
</article>
</main>
<footer class=footer>
<span>Copyright 2021 Krzysztof J. Czarnecki. Fair use permitted with authorship attribution. Commercial use disallowed without explicit permission. Some links in blog articles are affiliate links when noted.</span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>